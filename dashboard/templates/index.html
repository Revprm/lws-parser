<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Custom Log Parser – Alerts</title>
  <script>
    function summarize(data){
      const counts = {};
      for (const a of data) counts[a.type] = (counts[a.type]||0)+1;
      return counts;
    }
    document.addEventListener("DOMContentLoaded", () => {
      const data = JSON.parse(document.getElementById("alerts-json").textContent || "[]");
      const sum = summarize(data);
      const wrap = document.getElementById("summary");
      for (const k of Object.keys(sum).sort()){
        const li = document.createElement("li");
        li.textContent = `${k}: ${sum[k]}`;
        wrap.appendChild(li);
      }
    });
  </script>
  <style>
    body { font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; margin: 24px; }
    .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; margin-bottom: 24px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    table { border-collapse: collapse; width: 100%; }
    th, td { border-bottom: 1px solid #eee; padding: 8px 6px; text-align: left; font-size: 14px;}
    th { background: #fafafa; position: sticky; top: 0; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #ddd; font-size:12px;}
    .sev-high { background:#fee2e2; }
    .sev-medium { background:#fef3c7; }
    .sev-low { background:#e0f2fe; }
  </style>
</head>
<body>
  <h1>Custom Log Parser – Alerts</h1>
  <div class="card">
    <h2>Summary</h2>
    <ul id="summary"></ul>
    <p><a href="/download/alerts.json">Download alerts.json</a></p>
  </div>

  <div class="card">
    <h2>Alerts</h2>
    <table>
      <thead>
        <tr>
          <th>Time (UTC)</th><th>Type</th><th>Severity</th><th>IP</th><th>Details</th>
        </tr>
      </thead>
      <tbody>
        {% for a in alerts %}
        <tr>
          <td>{{ a["ts"] }}</td>
          <td>{{ a["type"] }}</td>
          <td><span class="pill sev-{{ a['severity'] }}">{{ a["severity"] }}</span></td>
          <td>{{ a["ip"] }}</td>
          <td><code>{{ a["details"] }}</code></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script id="alerts-json" type="application/json">{{ alerts|tojson }}</script>
</body>
</html>
